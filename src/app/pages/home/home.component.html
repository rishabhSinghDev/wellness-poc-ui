<div
  class="min-h-screen bg-[#fefefe] dark:bg-[#1e1e2f] text-[#333] dark:text-[#f4f4f4] px-6 pt-24 pb-12 font-sans overflow-x-hidden">

  <!-- Floating Avatar -->
  <div class="fixed top-6 left-6 z-50 w-36 h-36 transition-all duration-700">
    <ng-lottie [options]="lottieOptions" style="width: 100%; height: auto;"></ng-lottie>
  </div>

  <div class="flex flex-col gap-12 items-center w-full">

    <!-- Greeting -->
    <div class="text-center text-[clamp(2rem,6vw,3.5rem)] font-medium tracking-wide"
      style="font-family: 'Dancing Script', cursive;">
      {{ greetingMessage }} 👋
    </div>

    <div class="grid grid-cols-[1fr_4fr] gap-4 w-full max-w-6xl">

      <!-- Upcoming Activity Section -->
      <div class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 flex flex-col justify-between">
        <div class="w-full mb-4">
          <h2 class="text-l font-bold">📌 Upcoming Activity</h2>
        </div>
        <div class="flex flex-col items-center justify-center gap-2 text-center">
          <div class="text-5xl">{{ upcomingActivity.icon }}</div>
          <div class="text-l font-semibold">{{ upcomingActivity.activity }}</div>
        </div>
        <div class="text-xs font-semibold text-gray-600 dark:text-gray-300">
          {{ upcomingActivity.date }} at {{ upcomingActivity.time }}
        </div>
      </div>

      <!-- Streak Section (80%) -->
      <div class="w-full bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6">
        <h2 class="text-xl font-bold mb-6">📈 10-Day Streak</h2>
        <div class="relative w-full overflow-x-auto">
          <svg viewBox="0 0 1200 180" class="w-full h-44">
      
            <!-- Connection Lines -->
            <g class="fade-lines">
              <!-- Group 1 -->
              <line x1="100" y1="80" x2="210" y2="80" stroke="#8dd3c7" stroke-width="4" />
              <line x1="210" y1="80" x2="320" y2="80" stroke="#8dd3c7" stroke-width="4" />
              <line x1="320" y1="80" x2="430" y2="80" stroke="#8dd3c7" stroke-width="4" />
              <!-- Group 2 -->
              <line x1="650" y1="80" x2="760" y2="80" stroke="#fdb462" stroke-width="4" />
              <line x1="760" y1="80" x2="870" y2="80" stroke="#fdb462" stroke-width="4" />
              <line x1="870" y1="80" x2="980" y2="80" stroke="#fdb462" stroke-width="4" />
              <line x1="980" y1="80" x2="1090" y2="80" stroke="#fdb462" stroke-width="4" />
            </g>
      
            <!-- Ring Groups -->
            <g class="ring-group">
              <!-- Days 1-4 -->
              <g transform="translate(80, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="38"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="70"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="22"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <title>May 13\nStretch: 8\nBreathing: 5\nJournal: 7</title>
              </g>
      
              <g transform="translate(190, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="100"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="40"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="60"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <title>May 14\nStretch: 4\nBreathing: 8\nJournal: 2</title>
              </g>
      
              <g transform="translate(300, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="150"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="70"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="20"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <title>May 15\nStretch: 2\nBreathing: 5\nJournal: 9</title>
              </g>
      
              <g transform="translate(410, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="90"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="140"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="0"
                  stroke-linecap="round" class="animate-ring ring-soft" />
                <title>May 16\nStretch: 5\nBreathing: 10\nJournal: 10</title>
              </g>
      
              <!-- Day 5 - Sad Emoji -->
              <g transform="translate(520, 80)">
                <circle r="36" fill="#ccc" opacity="0.2" />
                <text x="0" y="10" text-anchor="middle" font-size="24" class="bounce-sad">😔</text>
                <title>May 17\nNo Activity</title>
              </g>
      
              <!-- Days 6-10 -->
              <g transform="translate(630, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="30"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="90"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="10"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <title>May 18\nStretch: 9\nBreathing: 3\nJournal: 8</title>
              </g>
      
              <g transform="translate(740, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="60"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="60"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="50"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <title>May 19\nStretch: 6\nBreathing: 6\nJournal: 6</title>
              </g>
      
              <g transform="translate(850, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="95"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="45"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="30"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <title>May 20\nStretch: 3\nBreathing: 9\nJournal: 4</title>
              </g>
      
              <g transform="translate(960, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="15"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="120"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="70"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <title>May 21\nStretch: 10\nBreathing: 2\nJournal: 1</title>
              </g>
      
              <g transform="translate(1070, 80)">
                <circle r="34" stroke="#8dd3c7" stroke-width="10" fill="none" stroke-dasharray="190" stroke-dashoffset="0"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="24" stroke="#80b1d3" stroke-width="10" fill="none" stroke-dasharray="140" stroke-dashoffset="0"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <circle r="14" stroke="#fdb462" stroke-width="10" fill="none" stroke-dasharray="88" stroke-dashoffset="0"
                  stroke-linecap="round" class="animate-ring ring-strong" />
                <title>May 22\nStretch: 10\nBreathing: 10\nJournal: 10</title>
              </g>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <!-- Row 2: Leaderboard + Journal Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-6xl">

      <!-- Leaderboard -->
      <div class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 overflow-auto max-h-[300px]">
        <h2 class="text-l font-bold mb-4">🏆 Leaderboard</h2>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="text-left text-gray-500 dark:text-gray-300 border-b border-gray-300">
                <th class="py-2 pr-4">Rank</th>
                <th class="py-2 pr-4">Name</th>
                <th class="py-2 pr-4">Total</th>
                <th class="py-2 pr-4">Stretch</th>
                <th class="py-2 pr-4">Breathe</th>
                <th class="py-2">Journal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of leaderboardData" class="border-b border-gray-200 dark:border-gray-700">
                <td class="py-2 pr-4">{{ user.rank }}</td>
                <td class="py-2 pr-4">{{ user.name }}</td>
                <td class="py-2 pr-4">{{ user.sessionScore }}</td>
                <td class="py-2 pr-4">{{ user.stretch }}</td>
                <td class="py-2 pr-4">{{ user.breathing }}</td>
                <td class="py-2">{{ user.journal }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Journal Summary -->
      <div class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 relative">
        <h2 class="text-l font-bold mb-4">📔 Journal Summary</h2>
        <div class="absolute top-6 right-6 text-xs text-gray-500 dark:text-gray-300">
          {{ today.toDateString() }}
        </div>

        <div class="flex justify-center gap-8 w-full">
          <div *ngFor="let period of ['morning', 'afternoon', 'evening']" class="flex flex-col items-center">
            <div class="font-semibold capitalize mb-2">{{ period }}</div>
            <!-- Relative wrapper for positioning tooltips -->
            <div class="relative w-14 h-44">
              <!-- Scrollable emoji track -->
              <div
                class="absolute inset-0 flex flex-col-reverse justify-start gap-1 overflow-y-auto scroll-smooth border-l-2 border-r-2 border-b-2 border-gray-400 rounded-b-2xl z-10">

                <div *ngFor="let entry of journalSummary[period]; let i = index"
                  (mouseenter)="hoveredEmojiIndexByPeriod[period] = i"
                  (mouseleave)="hoveredEmojiIndexByPeriod[period] = null"
                  class="relative w-full flex justify-center group cursor-pointer">

                  <!-- Emoji -->
                  <div class="text-2xl text-center animate-drop" [style.animationDelay]="(i * 300) + 'ms'">
                    {{ entry.mood }}
                  </div>
                </div>
              </div>

              <!-- Tooltips: rendered in a separate layer, outside overflow area -->
              <ng-container *ngFor="let entry of journalSummary[period]; let i = index">
                <div *ngIf="hoveredEmojiIndexByPeriod[period] === i"
                  class="absolute left-1/2 -translate-x-1/2 z-20 w-52 text-xs px-3 py-2 bg-black text-white rounded shadow-lg text-center pointer-events-none transition-opacity duration-300"
                  [style.bottom]="(i * 40 + 8) + 'px'">
                  <div><strong>Time:</strong> {{ entry.time }}</div>
                  <div><strong>Sentiment:</strong> {{ entry.sentiment }}</div>
                  <div><strong>Summary:</strong> {{ entry.summary }}</div>
                </div>
              </ng-container>
            </div>
          </div>

        </div>

      </div>
    </div>
    <!-- Start Session Button -->
    <div class="transition-opacity duration-1000"
      [ngClass]="{ 'opacity-100': startVisible, 'opacity-0': !startVisible }">
      <button
        class="bg-gradient-to-r from-cyan-400 to-sky-500 text-white text-sm sm:text-base md:text-lg font-semibold px-4 sm:px-5 md:px-6 py-2 sm:py-2.5 md:py-3 rounded-full shadow-md hover:scale-105 transition duration-300 max-w-xs"
        (click)="openSessionSelector()">
        Start Session
      </button>
    </div>
  </div>
  <app-session-selector *ngIf="showSelector" (close)="closeSelector()"
    (selectSession)="navigateToSession($event)"></app-session-selector>
</div>