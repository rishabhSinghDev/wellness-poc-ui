<div
  class="min-h-screen bg-[#fefefe] dark:bg-[#1e1e2f] text-[#333] dark:text-[#f4f4f4] px-6 pt-24 pb-12 font-sans overflow-x-hidden">

  <!-- Floating Avatar -->
  <div class="fixed top-6 left-6 z-50 w-36 h-36 transition-all duration-700">
    <ng-lottie [options]="lottieOptions" style="width: 100%; height: auto;"></ng-lottie>
  </div>

  <div class="flex flex-col gap-12 items-center w-full">

    <!-- Greeting -->
    <div class="text-center text-[clamp(2rem,6vw,3.5rem)] font-medium tracking-wide"
      style="font-family: 'Dancing Script', cursive;">
      {{ greetingMessage }} 👋
    </div>

    <div class="grid grid-cols-[1fr_4fr] gap-4 w-full max-w-6xl">

      <!-- Upcoming Activity Section -->
      <div class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 flex flex-col justify-between">
        <div class="w-full mb-4">
          <h2 class="text-l font-bold">📌 Upcoming Activity</h2>
        </div>
        <div class="flex flex-col items-center justify-center gap-2 text-center">
          <div class="text-5xl">{{ upcomingActivity.icon }}</div>
          <div class="text-l font-semibold">{{ upcomingActivity.activity }}</div>
        </div>
        <div class="text-xs font-semibold text-gray-600 dark:text-gray-300">
          {{ upcomingActivity.date }} at {{ upcomingActivity.time }}
        </div>
      </div>
      <div class="w-full bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6">
        <h2 class="text-xl font-bold mb-6">📈 Last 10 Days</h2>
        <div class="relative w-full overflow-x-auto" style="margin-left: -41px;">
          <svg viewBox="0 0 1350 240" class="w-full h-60">
            <!-- Connecting Lines (centered, not crossing emoji day) -->
            <g class="fade-lines">
              <line x1="145" y1="100" x2="190" y2="100" stroke="#32d74b" stroke-width="9" stroke-opacity="0.2" />
              <line x1="280" y1="100" x2="325" y2="100" stroke="#32d74b" stroke-width="9" stroke-opacity="0.2" />
              <line x1="415" y1="100" x2="460" y2="100" stroke="#32d74b" stroke-width="9" stroke-opacity="0.2" />
              <line x1="820" y1="100" x2="865" y2="100" stroke="#32d74b" stroke-width="9" />
              <line x1="955" y1="100" x2="1000" y2="100" stroke="#32d74b" stroke-width="9" />
              <line x1="1090" y1="100" x2="1135" y2="100" stroke="#32d74b" stroke-width="9" />
              <line x1="1225" y1="100" x2="1260" y2="100" stroke="#32d74b" stroke-width="9" />
            </g>
            <!-- Ring Groups with Underneath Day Data -->
            <g class="ring-group text-white text-xs font-mono">

              <g transform="translate(100, 100)" class="ring-faded">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="216" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 14&#10;Frequency: 1</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="126" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 14&#10;Frequency: 3</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="44" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 14&#10;Frequency: 5</title>
                </circle>
              </g>
              <!-- Day 2 -->
              <g transform="translate(235, 100)" class="ring-faded">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="192" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 15&#10;Frequency: 2</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="180" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 15&#10;Frequency: 0</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="0" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 15&#10;Frequency: 10</title>
                </circle>
              </g>
              <!-- Day 3 -->
              <g transform="translate(370, 100)" class="ring-faded">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="48" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 16&#10;Frequency: 8</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="108" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 16&#10;Frequency: 4</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="88" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 16&#10;Frequency: 0</title>
                </circle>
              </g>
              <!-- Day 4 -->
              <g transform="translate(505, 100)" class="ring-faded">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="0" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 17&#10;Frequency: 10</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="184" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 17&#10;Frequency: 2</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="44" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 17&#10;Frequency: 5</title>
                </circle>
              </g>
              <!-- Day 5 (Sad emoji) -->
              <g transform="translate(640, 100)">
                <circle r="40" fill="#ccc" opacity="0.2">
                  <title>No Activity&#10;Date: May 18</title>
                </circle>
                <text x="0" y="22" text-anchor="middle" font-size="24" class="bounce-sad text-[3.5rem]">😔</text>
              </g>
              <!-- Day 6 -->
              <g transform="translate(775, 100)">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="180" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 19&#10;Frequency: 3</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="18" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 19&#10;Frequency: 9</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="70" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 19&#10;Frequency: 2</title>
                </circle>
              </g>

              <g transform="translate(910, 100)">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="192" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 20&#10;Frequency: 2</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="126" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 20&#10;Frequency: 3</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="52" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 20&#10;Frequency: 4</title>
                </circle>
              </g>
              <g transform="translate(1045, 100)">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="96" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 21&#10;Frequency: 6</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="36" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 21&#10;Frequency: 8</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="0" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 21&#10;Frequency: 10</title>
                </circle>
              </g>
              <g transform="translate(1180, 100)">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="200" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 22&#10;Frequency: 4</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="162" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 22&#10;Frequency: 10</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="35" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 22&#10;Frequency: 6</title>
                </circle>
              </g>

              <g transform="translate(1305, 100)">
                <circle r="38" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="26" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />
                <circle r="14" stroke="black" stroke-opacity="0.4" stroke-width="14" fill="none" />

                <circle r="38" stroke="#ff2d55" stroke-width="14" fill="none" stroke-dasharray="240"
                  stroke-dashoffset="144" stroke-linecap="round" class="animate-stretch" transform="rotate(-90 0 0)">
                  <title>Activity: Stretch&#10;Date: May 23&#10;Frequency: 4</title>
                </circle>

                <circle r="26" stroke="#32d74b" stroke-width="14" fill="none" stroke-dasharray="180"
                  stroke-dashoffset="180" stroke-linecap="round" class="animate-breath" transform="rotate(-90 0 0)">
                  <title>Activity: Breathe&#10;Date: May 23&#10;Frequency: 0</title>
                </circle>

                <circle r="14" stroke="#FFDE03" stroke-width="14" fill="none" stroke-dasharray="88"
                  stroke-dashoffset="88" stroke-linecap="round" class="animate-journal" transform="rotate(-90 0 0)">
                  <title>Activity: Journal&#10;Date: May 23&#10;Frequency: 0</title>
                </circle>
              </g>
            </g>
            <g class="badge-group">
              <path d="M775,52 Q1040,-90 1305,52" fill="none" stroke="#32d74b" stroke-width="7" class="brace-curve" />
              <!-- Badge Circle -->
              <circle cx="1040" cy="-10" r="35" fill="#fff" stroke="#32d74b" stroke-width="3" class="badge-circle" />

              <!-- Image inside circle -->
              <image x="990" y="-65" width="100" height="100" xlink:href="assets/img/achievement-badge.png"
                class="badge-image" />
            </g>
          </svg>
        </div>
      </div>
    </div>

    <!-- Row 2: Leaderboard + Journal Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-6xl">
      <div
        class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 max-h-[300px] overflow-y-auto border border-white/20 ring-1 ring-white/10">
        <h2 class="text-l font-bold mb-4">🏆 Leaderboard</h2>

        <div class="overflow-x-auto rounded-lg border border-white/20">
          <table class="w-full text-sm table-fixed border-collapse">
            <thead>
              <tr class="text-left text-gray-600 dark:text-gray-300 bg-white/5">
                <th class="py-3 px-4 w-1/3 border-b border-white/20">Rank</th>
                <th class="py-3 px-4 w-1/3 border-b border-white/20">Name</th>
                <th class="py-3 px-4 w-1/3 border-b border-white/20">Streak Score</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of leaderboardData; let i = index"
                [ngClass]="i === 0 ? 'first-place-glow' : 'hover:bg-white/5 transition-all border-b border-white/10'">
                <td class="py-3 px-4">{{ user.rank }}</td>
                <td class="py-3 px-4">{{ user.name }}</td>
                <td class="py-3 px-4">{{ user.streakScore }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>


      <!-- Journal Summary -->
      <div class="bg-white/10 dark:bg-white/10 backdrop-blur-xl rounded-xl shadow-xl p-6 relative">
        <h2 class="text-l font-bold mb-4">⏱️ Mood Meter</h2>
        <div class="absolute top-6 right-6 text-xs text-gray-500 dark:text-gray-300">
          {{ today.toDateString() }}
        </div>

        <div class="flex justify-center gap-8 w-full">
          <div *ngFor="let period of ['morning', 'afternoon', 'evening', 'night']" class="flex flex-col items-center">
            <div class="font-semibold capitalize mb-2">{{ period }}</div>
            <!-- Relative wrapper for positioning tooltips -->
            <div class="emoji-column relative w-14 h-44">
              <!-- Scrollable emoji track -->
              <div
                class="emoji-track absolute inset-0 flex flex-col-reverse justify-start gap-1 overflow-y-auto scroll-smooth border-l-2 border-r-2 border-b-2 border-gray-400 rounded-b-2xl z-10">

                <div *ngFor="let entry of journalSummary[period]; let i = index"
                  (mouseenter)="hoveredEmojiIndexByPeriod[period] = i"
                  (mouseleave)="hoveredEmojiIndexByPeriod[period] = null"
                  class="emoji relative w-full flex justify-center group cursor-pointer"
                  [style.animationDelay]="(i * 200) + 'ms'">

                  <!-- Emoji -->
                  <!-- <div class="text-2xl text-center animate-drop" [style.animationDelay]="(i * 300) + 'ms'">
                    {{ entry.mood }}
                  </div> -->
                  <div class="text-[3.5rem] leading-none animate-drop" [style.animationDelay]="(i * 300) + 'ms'">
                    {{ entry.mood }}
                  </div>
                </div>
              </div>
              <!-- <ng-container *ngIf="getHoveredIndex(period) !== null">
                <div
                  class="absolute left-full top-[calc((hoveredEmojiIndexByPeriod[period] * 4rem) + 1.5rem)] bg-black text-white w-52 text-xs px-3 py-2 rounded shadow-lg z-50 emoji-tooltip tooltip-left"
                  style="transform: translateX(0);" [style.top]="(getHoveredIndex(period)! * 4.5) + 'rem'">
                  <div><strong>Time:</strong> {{ journalSummary[period][getHoveredIndex(period)!].time }}</div>
                  <div><strong>Sentiment:</strong> {{
                    journalSummary[period][getHoveredIndex(period)!].sentiment }}</div>
                  <div><strong>Summary:</strong> {{ journalSummary[period][getHoveredIndex(period)!].summary }}
                  </div>
                </div>
              </ng-container> -->
            </div>
            <!-- Tooltips: rendered in a separate layer, outside overflow area -->
            <ng-container *ngFor="let entry of journalSummary[period]; let i = index">
              <div *ngIf="hoveredEmojiIndexByPeriod[period] === i" class="emoji-tooltip tooltip-left"
                [style.bottom]="(i * 48 + 0) + 'px'"
                [style.left]="'calc(50% + ' + (period === 'morning' ? -250 : period === 'afternoon' ? -100 : period === 'evening' ? 100 : 250) + 'px)'">
                <div><strong>Time:</strong> {{ entry.time }}</div>
                <div><strong>Sentiment:</strong> {{ entry.sentiment }}</div>
                <div><strong>Summary:</strong> {{ entry.summary }}</div>
              </div>
            </ng-container>
          </div>
        </div>

      </div>
    </div>
    <!-- Start Session Button -->
    <div class="transition-opacity duration-1000"
      [ngClass]="{ 'opacity-100': startVisible, 'opacity-0': !startVisible }">
      <button
        class="bg-gradient-to-r from-cyan-400 to-sky-500 text-white text-sm sm:text-base md:text-lg font-semibold px-4 sm:px-5 md:px-6 py-2 sm:py-2.5 md:py-3 rounded-full shadow-md hover:scale-105 transition duration-300 max-w-xs"
        (click)="openSessionSelector()">
        Start Session
      </button>
    </div>
  </div>
  <app-session-selector *ngIf="showSelector" (close)="closeSelector()"
    (selectSession)="navigateToSession($event)"></app-session-selector>
</div>